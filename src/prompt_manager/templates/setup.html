{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>LLM Provider Setup</h2>
  <div id="setup-messages">
    {% if message %}
      <div class="alert alert-{{ message_type }}">{{ message }}</div>
    {% endif %}
  </div>
  <form method="post" id="llm-setup-form">
    <div class="mb-3">
      <label for="provider" class="form-label">Provider</label>
      <select class="form-select" id="provider" name="provider" disabled>
        <option value="openai" selected>OpenAI (GPT)</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="api_key" class="form-label">OpenAI API Key</label>
      <input type="password" class="form-control" id="api_key" name="api_key" placeholder="sk-..." value="" autocomplete="off">
      {% if has_key %}
        <div class="form-text text-success">API key is set.</div>
      {% else %}
        <div class="form-text text-danger">No API key set.</div>
      {% endif %}
    </div>
    <button type="submit" class="btn btn-primary">Save</button>
  </form>
</div>
<script>
  document.getElementById('llm-setup-form').onsubmit = async function(e) {
    e.preventDefault();
    const api_key = document.getElementById('api_key').value;
    const provider = document.getElementById('provider').value;
    const resp = await fetch('/api/llm/config', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ provider, api_key })
    });
    const data = await resp.json();
    const msgDiv = document.getElementById('setup-messages');
    if (resp.ok) {
      msgDiv.innerHTML = '<div class="alert alert-success">API key saved successfully.</div>';
    } else {
      msgDiv.innerHTML = `<div class="alert alert-danger">${data.error || 'Error saving key.'}</div>`;
    }
  };
</script>
{% endblock %} 